<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Node Lab: Servers & Shell</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: #e0e0e0; max-width: 900px; margin: auto; padding: 20px; }
        .myNav { text-align: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .myNav a { color: #888; text-decoration: none; margin: 0 15px; }
        .myCard { background: #1e1e1e; padding: 15px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; }
        .myTerminal { background: #000; color: #4ec9b0; padding: 10px; height: 120px; overflow-y: auto; font-family: monospace; font-size: 0.8rem; margin-top: 10px; }
        .myBtn { background: #198754; color: white; border: none; padding: 8px; width: 100%; border-radius: 5px; cursor: pointer; }
        iframe { width: 100%; height: 100px; background: white; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <nav class="myNav">
        <a href="index.html">Hub</a> | <a href="servers.html" style="color:#0d6efd">Servers</a> | <a href="data.html">Data</a> | <a href="chat.html">Network</a> | <a href="files.html">Files</a>
    </nav>

    <h2>üñ•Ô∏è Server & Shell Lab</h2>
    
    <div class="myCard">
        <h3>HTTP Server</h3>
        <button class="myBtn" id="mySrvBtn" onclick="myRunServer()" disabled>Launch Browser-Internal Server</button>
        <iframe id="myPreview" style="display:none;"></iframe>
        <div class="myTerminal" id="term1">Waiting for boot...</div>
    </div>

    <div class="myCard">
        <h3>Shell Execution (ls -la)</h3>
        <button class="myBtn" id="myLsBtn" onclick="myRunLs()" disabled>List Virtual Root Directory</button>
        <div class="myTerminal" id="term2">Waiting for boot...</div>
    </div>

    <script type="module">
        import { WebContainer } from 'https://unpkg.com/@webcontainer/api@1.1.8/dist/index.js';
        let myWebContainer;

        window.myRunServer = async () => {
            const myCode = "const http = require('http'); http.createServer((req, res) => { res.end('Node Server Active!'); }).listen(8080); console.log('Listening on 8080...');";
            await myWebContainer.fs.writeFile('/srv.js', myCode);
            await myWebContainer.spawn('node', ['srv.js']);
            myWebContainer.on('server-ready', (port, url) => {
                document.getElementById('myPreview').style.display = "block";
                document.getElementById('myPreview').src = url;
                document.getElementById('term1').innerText = "Server Live: " + url;
            });
        };

        window.myRunLs = async () => {
            const myProcess = await myWebContainer.spawn('ls', ['-la']);
            myProcess.output.pipeTo(new WritableStream({ write(d) { document.getElementById('term2').innerText = d; }}));
        };

        async function myInit() {
            if (!window.crossOriginIsolated) return;
            myWebContainer = await WebContainer.boot();
            document.querySelectorAll('.myBtn').forEach(b => b.disabled = false);
        }
        myInit();
    </script>
</body>
</html>
